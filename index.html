<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>馬券計算ツール</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  h2 { margin-top: 40px; }

  .container {
    display: flex;
    gap: 20px;
    align-items: flex-start;
  }

  table { border-collapse: collapse; }

  th, td {
    border: 1px solid #ccc;
    padding: 6px 8px;
    text-align: center;
    white-space: nowrap;
  }

  th { background: #f0f0f0; }

  summary { list-style: none; cursor: pointer; }
  summary::-webkit-details-marker { display: none; }

  input[type="checkbox"] {
    transform: scale(1.8);
    cursor: pointer;
  }

  input[type="text"] { width: 120px; }
  input[type="number"] { width: 60px; }

  .result-area { width: 100%; }

  .header-bar {
    display: flex;
    align-items: center;
    gap: 180px;
    padding: 6px 0;
    background: #fff;
    position: sticky;
    top: 0;
    z-index: 2;
  }

  .count { font-size: 16px; font-weight: bold; }
  .count-label { color: #888; margin-right: 4px; }

  button { padding: 4px 12px; cursor: pointer; }

  .result-scroll {
    max-height: 640px;
    overflow-y: auto;
    border-top: 1px solid #ccc;
  }

  .arrow-cell {
    width: 16px;
    padding: 0 2px;
    color: #bbb;
    font-weight: bold;
    border-left: none;
    border-right: none;
  }

  .no-border-right { border-right: none; padding-right: 4px; }
  .no-border-left  { border-left: none; padding-left: 4px; }

  .odds-very-low  { color: #7A0000; }
  .odds-low       { color: #B00000; }
  .odds-mid-low   { color: #E06666; }
  .odds-mid-high  { color: #6AA84F; }
  .odds-high      { color: #38761D; }
  .odds-very-high { color: #274E13; }

  .bg-odds-very-low  { background-color: #7A0000; color: white; }
  .bg-odds-low       { background-color: #A00000; color: white; }
  .bg-odds-mid-low   { background-color: #CC4444; color: white; }
  .bg-odds-mid-high  { background-color: #4C9933; color: white; }
  .bg-odds-high      { background-color: #28661C; color: white; }
  .bg-odds-very-high { background-color: #1F470F; color: white; }

  .memo-area { margin-top: 20px; }
  .memo-area textarea {
    width: 100%;
    min-height: 180px;
    padding: 10px;
    font-size: 14px;
    resize: vertical;
  }

  .csv-load { margin-bottom: 12px; }
  .csv-load input[type="text"] { width: 150px; margin-right: 6px; }
</style>
</head>
<body>

<div class="csv-load">
  <input type="text" id="raceName" placeholder="ファイル名を入力">
  <button onclick="loadCSV()">データ読込</button>
</div>

<details>
<summary><h2>3連単フォーメーション</h2></summary>

<div class="container">
<table id="triTable">
  <tr>
    <th>馬番</th><th>馬名</th><th>オッズ</th>
    <th>1着</th><th>2着</th><th>3着</th>
  </tr>
</table>

<div class="result-area">
  <div class="header-bar">
    <div class="count">
      <span class="count-label">組み合わせ：</span>
      <span id="triCount">0 点</span>
    </div>
    <button onclick="downloadCSV(triResults,'trifecta')">CSV出力</button>
  </div>

  <div class="result-scroll">
    <table>
      <thead>
        <tr>
          <th colspan="5">馬番</th>
          <th colspan="5">馬名</th>
          <th colspan="5">オッズ</th>
        </tr>
      </thead>
      <tbody id="triResult"></tbody>
    </table>
  </div>
</div>
</div>
</details>

<details>
<summary><h2>ワイド（2頭）フォーメーション</h2></summary>

<div class="container">
<table id="wideTable">
  <tr>
    <th>馬番</th><th>馬名</th><th>オッズ</th>
    <th>選択1</th><th>選択2</th>
  </tr>
</table>

<div class="result-area">
  <div class="header-bar">
    <div class="count">
      <span class="count-label">組み合わせ：</span>
      <span id="wideCount">0 点</span>
    </div>
    <button onclick="downloadCSV(wideResults,'wide')">CSV出力</button>
  </div>

  <div class="result-scroll">
    <table>
      <thead>
        <tr>
          <th colspan="3">馬番</th>
          <th colspan="3">馬名</th>
          <th colspan="3">オッズ</th>
        </tr>
      </thead>
      <tbody id="wideResult"></tbody>
    </table>
  </div>
</div>
</div>
</details>

<h2>メモ</h2>
<div class="memo-area">
  <textarea placeholder="ここにメモを自由に記入できます"></textarea>
</div>

<script>
const triResults = [];
const wideResults = [];

const triTable = document.getElementById("triTable");
const triBody  = document.getElementById("triResult");
const triCount = document.getElementById("triCount");

const wideTable = document.getElementById("wideTable");
const wideBody  = document.getElementById("wideResult");
const wideCount = document.getElementById("wideCount");

function safeText(v){ return v && v.trim() !== "" ? v : "-"; }
function formatOdds(v){ return isNaN(v)||v===""?"-":Number(v).toFixed(1); }

const syncDefinitions = [
  {
    from: triTable,
    to: wideTable,
    map: [
      { from: r => r.cells[1].children[0], to: r => r.querySelector(".wName") },
      { from: r => r.cells[2].children[0], to: r => r.querySelector(".wOdds") }
    ]
  },
  {
    from: wideTable,
    to: triTable,
    map: [
      { from: r => r.querySelector(".wName"), to: r => r.cells[1].children[0] },
      { from: r => r.querySelector(".wOdds"), to: r => r.cells[2].children[0] }
    ]
  }
];

function syncInputs(){
  syncDefinitions.forEach(def=>{
    [...def.from.rows].slice(1).forEach((fromRow,i)=>{
      const toRow = def.to.rows[i+1];
      if(!toRow) return;
      def.map.forEach(m=>{
        m.to(toRow).value = m.from(fromRow).value;
      });
    });
  });
}

for(let i=1;i<=18;i++){
  triTable.insertRow().innerHTML=`
    <th>${i}</th>
    <td><input type="text"></td>
    <td><input type="number" step="0.1"></td>
    <td><input type="checkbox" class="p1"></td>
    <td><input type="checkbox" class="p2"></td>
    <td><input type="checkbox" class="p3"></td>`;
    
  wideTable.insertRow().innerHTML=`
    <th>${i}</th>
    <td><input class="wName" style="width:120px;"></td>
    <td><input class="wOdds" style="width:60px;"></td>
    <td><input type="checkbox" class="w1"></td>
    <td><input type="checkbox" class="w2"></td>`;
}

triTable.addEventListener("input",()=>{syncInputs();updateTrifecta();updateWide();});
triTable.addEventListener("change",()=>{syncInputs();updateTrifecta();updateWide();});
wideTable.addEventListener("input",()=>{syncInputs();updateTrifecta();updateWide();});
wideTable.addEventListener("change",()=>{syncInputs();updateTrifecta();updateWide();});

syncInputs();
</script>

</body>
</html>
